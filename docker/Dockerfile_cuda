#############################################################################
####                    G4-DSPS-Detector-Simulation                      ####
#############################################################################
####                                                                     ####
#### Author:                                                             ####
####   Noah Everett (noah.everett@mines.sdsmt.edu)                       ####
####                                                                     ####
#### This file is based on the anniedirt Dockerfile created by me.       ####
#### https://github.com/ANNIEsoft/anniedirt/blob/genie_3_0_6/Dockerfile  ####
####                                                                     ####
#############################################################################



##############################
########## Set FROM ##########
##############################
FROM noaheverett/physicsbase:1.0.2-x86-Cuda



##############################
########## Set User ##########
##############################
USER root



#########################################
########## DSPS-Detector Build ##########
#########################################
# Clone, configure, and build DSPS
RUN git clone --recurse-submodules --depth 1 https://github.com/Noah-Everett/DSPS-Detector /DSPS \
 && cp /DSPS/docker/setup_Dockerfile.sh /setup_Dockerfile.sh \
 && chmod +x /setup_Dockerfile.sh \
 && source /setup_Dockerfile.sh \
 && mkdir -p /DSPS/build \
 && cd /DSPS/build \
 && cmake .. \
 && make -j$(nproc)

# Install Python requirements inside dsps env
RUN pip install --no-cache-dir -r /DSPS/requirements.txt



##########################################
########## Fast Voxel Traversal ##########
##########################################
RUN git clone --depth 1 https://github.com/Noah-Everett/Fast-Voxel-Traversal-Python /Fast_Voxel_Traversal_Python \
 && pip install /Fast_Voxel_Traversal_Python