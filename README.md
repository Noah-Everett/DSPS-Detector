# G4-DSPS-Detector-Sim

<!-- This project is a simulation of a detector system using the Geant4 software toolkit. It is designed to simulate the interaction of particles with a detector, and provides a framework for analyzing the results of these interactions. -->

This repository contains a simulation of a detector system using the [Geant4](https://cern.ch/geant4) and [NEST](https://nest.physics.ucdavis.edu) toolkits. The simulation is designed to model the interaction of particles with a detector, and provides a framework for analyzing the results of these interactions with python scripts.

## Getting Started

To run the simulation, you need to have [Geant4](https://cern.ch/geant4) and [NEST](https://nest.physics.ucdavis.edu) installed on your system. Here are some useful links to get started:

### Geant4:
- [Home Page](https://cern.ch/geant4)
- [Git Repository](https://gitlab.cern.ch/geant4/geant4)
- [Installation Guide](https://geant4-userdoc.web.cern.ch/UsersGuides/InstallationGuide/html/index.html)
- [CMake Options](https://geant4-userdoc.web.cern.ch/UsersGuides/InstallationGuide/html/installguide.html#geant4-build-options)

### NEST:
- [Home Page](https://nest.physics.ucdavis.edu)
- [Git Repository](https://github.com/NESTCollaboration/nest)
- [Installation Guide](https://github.com/NESTCollaboration/nest?tab=readme-ov-file#get)
- [CMake Options](https://github.com/NESTCollaboration/nest?tab=readme-ov-file#config)

Your CMake command for Geant4 should look something like this where `<>` marks the variables you need to replace and `[]` marks optional variables:
```
$ cmake -S <Geant4SourceDirectory> \
        -B <Geant4BuildDirectory> \
       [-DCMAKE_INSTALL_PREFIX=<Geant4InstallDirectory>] \
        -DGEANT4_INSTALL_DATA=ON \
        -DGEANT4_USE_GDML=ON \
       [-DGEANT4_USE_OPENGL_X11=ON] \
       [-DGEANT4_USE_QT=ON] \
       [-DGEANT4_USE_OPENGL_X11=ON]
```

Likewise, your CMake command for NEST should look something like this:
```
$ cmake -S <NESTSourceDirectory> \
        -B <NESTBuildDirectory> \
       [-DCMAKE_INSTALL_PREFIX=<NESTInstallDirectory>] \
        -DG4=ON \
       [-DBUILD_ROOT=ON] \
       [-DGeant4_DIR=<Geant4InstallDir>/lib/cmake/Geant4]
```

Once you have everything installed, you can clone this repository and build the simulation with
```
$ cmake -S <DSPSSourceDirectory> \
        -B <DSPSBuildDirectory> \
       [-DGeant4_DIR=<Geant4InstallDirectory>/lib/cmake/Geant4] \
       [-DNEST_DIR=<NESTInstallDirectory>/lib/cmake/NEST]
$ cd <DSPSBuildDirectory>
$ make [-j<numberOfCPUs>]
```

## Usage

To run the simulation, you can use the `DSPS` executable generated by the build process. The most basic way to run the simulation is with no arguments. This will initialize the simulation with default parameters from `macros/parameters_*` and open the visualization window:
```
$ ./DSPS
```


The simulation is controlled by a set of macro files that specify the parameters of the simulation. These macro files are located in the [`macros`](https://github.com/Noah-Everett/DSPS-Detector/tree/main/macros) directory. You can run the simulation with a specific macro file by passing it as an argument to the `DSPS` executable:

For example, you can use `event.mac` as:
```
$ ./DSPS event.mac
```

You 

### Detector Configuration

The detector configuration can be adjusted using the parameters in the `parameters_detector.mac` macro:
```
/geometry/calorimeter/size                       10.0 2.00 40.0 cm
/geometry/calorimeter/material                   aluminum
/geometry/calorimeter/visibility                 true
/geometry/calorimeter/color                      red
/geometry/calorimeter/alpha                      0.3
/geometry/calorimeter/forceSolid                 true

/geometry/photoSensor/surface/size               10.0 10.0 0.50 cm
/geometry/photoSensor/surface/material           ANNIEWater_unDoped
/geometry/photoSensor/surface/visibility         true
/geometry/photoSensor/surface/color              blue
/geometry/photoSensor/surface/alpha              1
/geometry/photoSensor/surface/forceSolid         true

/geometry/photoSensor/body/size                  10.0 10.0 2.00 cm
/geometry/photoSensor/body/material              ANNIEWater_unDoped
/geometry/photoSensor/body/visibility            true
/geometry/photoSensor/body/color                 blue
/geometry/photoSensor/body/alpha                 0.5
/geometry/photoSensor/body/forceSolid            true
```

This includes parameters such as the size and material of the calorimeter and photo sensor.

### Output

The simulation results are outputted for analysis. The output parameters can be adjusted using the `parameters_output.mac` macro:
```
/GDML/save                                            false
/GDML/fileName                                        geometry.gdml

/output/fileName                                      output.root

/output/photoSensor/hits/position/binned/save         true
/output/photoSensor/hits/position/binned/nBinsPerSide 100
/output/photoSensor/hits/position/save                true
/output/photoSensor/hits/time/save                    true

/output/primary/position/save                         true
/output/primary/emission/photon/save                  true
/output/primary/emission/electron/save                true
/output/primary/process/save                          true
/output/primary/time/save                             true

/output/photon/length/save                            true
/output/photon/process/save                           true
/output/photon/time/save                              true
```

### License

This project is licensed under the terms of the Geant4 Software License. Please see the license in the file LICENSE and URL above for the full disclaimer and the limitation of liability.
```
// ********************************************************************
// * License and Disclaimer                                           *
// *                                                                  *
// * The  Geant4 software  is  copyright of the Copyright Holders  of *
// * the Geant4 Collaboration.  It is provided  under  the terms  and *
// * conditions of the Geant4 Software License,  included in the file *
// * LICENSE and available at  http://cern.ch/geant4/license .  These *
// * include a list of copyright holders.                             *
// *                                                                  *
// * Neither the authors of this software system, nor their employing *
// * institutes,nor the agencies providing financial support for this *
// * work  make  any representation or  warranty, express or implied, *
// * regarding  this  software system or assume any liability for its *
// * use.  Please see the license in the file  LICENSE  and URL above *
// * for the full disclaimer and the limitation of liability.         *
// *                                                                  *
// * This  code  implementation is the result of  the  scientific and *
// * technical work of the GEANT4 collaboration.                      *
// * By using,  copying,  modifying or  distributing the software (or *
// * any work based  on the software)  you  agree  to acknowledge its *
// * use  in  resulting  scientific  publications,  and indicate your *
// * acceptance of all terms of the Geant4 Software license.          *
// ********************************************************************
```

### Contributing

Contributions are welcome. Please make sure to update tests as appropriate.

### Disclaimer

This code implementation is the result of the scientific and technical work of the GEANT4 collaboration. By using, copying, modifying or distributing the software (or any work based on the software) you agree to acknowledge its use in resulting scientific publications, and indicate your acceptance of all terms of the Geant4 Software license.